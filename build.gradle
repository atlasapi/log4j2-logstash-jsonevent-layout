description = 'Log4J2 Layout for outputting LogStash json_event format'

apply plugin: 'java'
apply plugin: 'maven'

def localMavenRepo = "file:///localhost/home/firojoha/.m2/repository/"
repositories {
    mavenCentral()
    mavenRepo urls: localMavenRepo
}
version = "0.1.1-FINN"
group = "no.finntech.log4j2"

dependencies {

    // JACKSON for JSONification
    def jacksonVersion = '2.2.2'
    compile "com.fasterxml.jackson.core:jackson-core:${jacksonVersion}"
    compile "com.fasterxml.jackson.core:jackson-annotations:${jacksonVersion}"
    compile "com.fasterxml.jackson.core:jackson-databind:${jacksonVersion}"

    def log4j2Version = '2.0-beta9';
    compile "org.apache.logging.log4j:log4j-api:$log4j2Version"
    compile "org.apache.logging.log4j:log4j-core:$log4j2Version"

    // APACHE COMMONS
    compile 'org.apache.commons:commons-lang3:3.1'

    // Testing stuff, hamcrest comes first please
    testCompile 'org.hamcrest:hamcrest-all:1.3'
    testCompile 'org.testng:testng:6.8.5'
    testCompile 'commons-collections:commons-collections:3.2.1'
}


test {
    useTestNG() {
        excludeGroups 'integration'
    }

}

task integrationTest(type: Test, dependsOn: ['test']) {
    logger.info 'Integration Tests'
    useTestNG() {
    }
    include '**/*IT.class'

    // copy resource over???

    // set a system property for the test JVM(s)
    systemProperty 'archaius.deployment.applicationId', 'jaxrs-service'
    systemProperty 'archaius.deployment.environment', 'dev'

    doFirst {
        logger.info 'Logstash required for integration tests'
//  start logstash or check for logstash and fail
    }

    doLast {
//		logger.info 'Stop Logstash'
// stop logstash
    }
}

